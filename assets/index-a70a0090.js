import*as a from"https://unpkg.com/three@latest/build/three.module.js";import{OrbitControls as P}from"https://unpkg.com/three@latest/examples/jsm/controls/OrbitControls.js";import U from"https://cdn.jsdelivr.net/npm/lil-gui@0.18/+esm";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function e(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(t){if(t.ep)return;t.ep=!0;const r=e(t);fetch(t.href,r)}})();const z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAmSURBVDhPYyAVMALx////IRyCgJGRkQnKJBqMaiAGjGqgAWBgAAC7uQMcG4GT/wAAAABJRU5ErkJggg==";class G{constructor(n=25,e=3,i=5,t=6){this.dimension=n,this.makeArray(this.dimension),this.starve=e,this.live=i,this.survive=t,this.casting=!0,this.updating=!1,this.densityBased=!1,this.ALIVE=1,this.DEAD=0}makeArray(n){this.grid=new Array(n);for(let e=0;e<this.dimension;e++){this.grid[e]=new Array(n);for(let i=0;i<this.dimension;i++)this.grid[e][i]=new Array(n)}this.needsUpdate=new Array(n);for(let e=0;e<this.dimension;e++){this.needsUpdate[e]=new Array(n);for(let i=0;i<this.dimension;i++)this.needsUpdate[e][i]=new Array(n)}this.pointsArray=new Array(n);for(let e=0;e<this.dimension;e++){this.pointsArray[e]=new Array(n);for(let i=0;i<this.dimension;i++)this.pointsArray[e][i]=new Array(n)}}randomizeArray(n=5){for(var e=0;e<this.dimension;e++)for(var i=0;i<this.dimension;i++)for(var t=0;t<this.dimension;t++)this.grid[e][i][t]=Math.random()<n/100;for(var e=0;e<this.dimension;e=e+2)for(var i=0;i<this.dimension;i=i+2)for(var t=0;t<this.dimension;t=t+2)this.needsUpdate[e][i][t]=0}makePoints(n){this.parent=n;const e=new a.BufferGeometry;let i=new a.BufferAttribute(new Float32Array([0,0,0]),3);e.setAttribute("position",i);const t=new a.BoxGeometry(1/this.dimension,1/this.dimension,1/this.dimension);let m=new a.TextureLoader().load(z);for(var d=0;d<this.dimension;d++)for(var h=0;h<this.dimension;h++)for(var l=0;l<this.dimension;l++)this.grid[d][h][l]=0,Math.sqrt((d/this.dimension-.5)**2+(h/this.dimension-.5)**2+(l/this.dimension-.5)**2),this.pointsArray[d][h][l]=new a.Mesh(t,new a.MeshBasicMaterial({color:new a.Color(d**.75/this.dimension,h**.75/this.dimension,l**.75/this.dimension),transparent:!0,opacity:.75,visible:!1,map:m})),this.pointsArray[d][h][l].clickable=!1,n.add(this.pointsArray[d][h][l]),this.pointsArray[d][h][l].position.set(d/this.dimension,h/this.dimension,l/this.dimension);this.dimension%2?(this.pointsArray[(this.dimension-1)/2][(this.dimension-1)/2][(this.dimension-1)/2].material.visible=!0,this.pointsArray[(this.dimension-1)/2][(this.dimension-1)/2][(this.dimension-1)/2].clickable=1,this.grid[(this.dimension-1)/2][(this.dimension-1)/2][(this.dimension-1)/2]=1):(this.pointsArray[this.dimension/2][this.dimension/2][this.dimension/2].material.visible=!0,this.pointsArray[this.dimension/2][this.dimension/2][this.dimension/2].clickable=!0,this.grid[this.dimension/2][this.dimension/2][this.dimension/2]=1)}reset(){for(var n=0;n<this.dimension;n++)for(var e=0;e<this.dimension;e++)for(var i=0;i<this.dimension;i++)this.grid[n][e][i]=0,this.pointsArray[n][e][i].clickable=!1,this.pointsArray[n][e][i].material.visible=!1;this.dimension%2?(this.pointsArray[(this.dimension-1)/2][(this.dimension-1)/2][(this.dimension-1)/2].material.visible=!0,this.pointsArray[(this.dimension-1)/2][(this.dimension-1)/2][(this.dimension-1)/2].clickable=1,this.grid[(this.dimension-1)/2][(this.dimension-1)/2][(this.dimension-1)/2]=1):(this.pointsArray[this.dimension/2][this.dimension/2][this.dimension/2].material.visible=!0,this.pointsArray[this.dimension/2][this.dimension/2][this.dimension/2].clickable=!0,this.grid[this.dimension/2][this.dimension/2][this.dimension/2]=1),this.recolor()}recolor(){let n;if(this.densityBased)for(var e=0;e<this.dimension;e++)for(var i=0;i<this.dimension;i++)for(var t=0;t<this.dimension;t++)n=this.countNeighbors(e,i,t),this.pointsArray[e][i][t].material.color=new a.Color(n/6,1/8,1/8),n<=6?this.pointsArray[e][i][t].material.opacity=.75-n/26:(this.pointsArray[e][i][t].material.color=new a.Color(11184810),this.pointsArray[e][i][t].material.opacity=1/3);else for(var e=0;e<this.dimension;e++)for(var i=0;i<this.dimension;i++)for(var t=0;t<this.dimension;t++)this.pointsArray[e][i][t].material.color=new a.Color(e**.75/this.dimension,i**.75/this.dimension,t**.75/this.dimension)}updateAndDraw(n=!0){n==!0&&this.update();for(var e=0;e<this.dimension;e++)for(var i=0;i<this.dimension;i++)for(var t=0;t<this.dimension;t++)this.needsUpdate[e][i][t]&&(this.pointsArray[e][i][t].material.visible=this.grid[e][i][t]);this.densityBased&&this.recolor()}redoAll(n){this.randomizeArray(n);for(var e=0;e<this.dimension;e++)for(var i=0;i<this.dimension;i++)for(var t=0;t<this.dimension;t++)this.needsUpdate[e][i][t]=1,this.pointsArray[e][i][t].clickable=this.grid[e][i][t];this.recolor(),this.updateAndDraw(!1)}countNeighbors(n,e,i,t=this.grid){for(var r=0,m=-1;m<2;m++)if(!(n+m<0||n+m>=this.dimension)){for(var d=-1;d<2;d++)if(!(e+d<0||e+d>=this.dimension))for(var h=-1;h<2;h++)i+h<0||i+h>=this.dimension||t[n+m][e+d][i+h]==1&&!(m==0&&d==0&&h==0)&&r++}return r}deepClone3DArray(n,e=!0){return e?this.grid.map(function(i){return i.map(function(t){return t.slice()}).slice()}):n.map(function(i){return i.map(function(t){return t.map(function(r){return Array.isArray(r)?r.slice():r})})})}update(){const n=this.deepClone3DArray(this.grid,!0);for(var e=0;e<this.dimension;e++)for(var i=0;i<this.dimension;i++)for(var t=0;t<this.dimension;t++)this.updateCell([e,i,t],this.countNeighbors(e,i,t,n))}updateCell(n,e){let i=n[0],t=n[1],r=n[2];if(e<=this.starve)this.swapLife(i,t,r,this.DEAD);else if(e>this.starve&&e<=this.live){let m=this.grid[i][t][r]&&!this.ALIVE||!this.grid[i][t][r]&&this.ALIVE;this.swapLife(i,t,r,this.ALIVE,m)}else if(e>this.live&&e<=this.survive){let m=this.grid[i][t][r]&&!1||!this.grid[i][t][r]&&1;this.swapLife(i,t,r,this.grid[i][t][r],m)}else this.swapLife(i,t,r,this.DEAD)}swapLife(n,e,i,t,r=!0){this.needsUpdate[n][e][i]=r,this.grid[n][e][i]=t}modifyBlock(n,e){n.x>=this.dimension||n.y>=this.dimension||n.z>=this.dimension||(this.grid[n.x][n.y][n.z]=e,this.pointsArray[n.x][n.y][n.z].material.visible=e,this.pointsArray[n.x][n.y][n.z].clickable=e)}}const E=new a.Scene,u=new a.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),L=new a.Raycaster;var p;const C=new a.Vector2,A=new a.WebGLRenderer;A.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(A.domElement);const R=new P(u,A.domElement);u.position.set(1.125,1.125,1.125);R.update();var V=20,v={density:3},B={speed:30};const w=new U,D=w.addFolder("Parameters For Entropy"),x=w.addFolder("Aesthetic Parameters");var I={add:function(){s.updating=!s.updating,s.casting=!s.updating}},S={add:function(){s.casting=!1,s.redoAll(v.density),s.casting=!0}},O={add:function(){s.updating=!1,s.reset(),s.casting=!0}},W={add:function(){s.densityBased=!s.densityBased,s.recolor()}};D.add(v,"density",0,100,1);D.add(S,"add").name("Randomize (R)");x.add(B,"speed",0,59,1).name("Speed");x.add(W,"add").name("Color based on Density? (D)");w.add(O,"add").name("Clear (C)");w.add(I,"add").name("Play/Pause (Space)");const s=new G(V);s.randomizeArray(v.density);const y=new a.Object3D;E.add(y);y.position.set(-.5,-.5,-.5);var b=0,f,c,g;s.makePoints(y);A.setAnimationLoop(F);function F(){s.casting&&J(),s.updating&&(b=(b+1)%(60-B.speed),b==60-B.speed-1&&s.updateAndDraw()),A.render(E,u)}window.addEventListener("resize",Q);document.addEventListener("mousemove",H);document.addEventListener("keypress",o=>{o.key==" "?(s.updating=!s.updating,s.casting=!s.casting):o.key=="r"?(s.updating=!1,s.redoAll(v.density)):o.key=="c"?(s.updating=!1,s.reset()):o.key=="d"&&(s.densityBased=!s.densityBased,s.recolor())});document.addEventListener("mousedown",o=>{s.casting&&(p=L.intersectObjects(y.children,!1),p.length>0&&(f=M(p),f[0]&&s.modifyBlock(q(f[0],f[1],!o.button),!o.button)))});function Q(){u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),A.setSize(window.innerWidth,window.innerHeight)}function H(o){o.preventDefault(),C.x=o.clientX/window.innerWidth*2-1,C.y=-(o.clientY/window.innerHeight)*2+1}function M(o){for(let n=0;n<o.length;n++)if(o[n].object.clickable)return[o[n].object,o[n].point];return[null,null]}function q(o,n,e=!1){var i;if(e){let t=s.dimension%2?(s.dimension-1)/2:s.dimension/2;i=new a.Vector3(t+Math.round(n.x*s.dimension),t+Math.round(n.y*s.dimension),t+Math.round(n.z*s.dimension))}else i=new a.Vector3(o.position.x*s.dimension,o.position.y*s.dimension,o.position.z*s.dimension);return i}function J(){L.setFromCamera(C,u),p=L.intersectObjects(y.children,!1),f=M(p)[0],f?c!=f&&(c&&(c.material.color=g),c=f,g=c.material.color,c.material.color=new a.Color(16777215)):c&&g&&(c.material.color=g,c=null)}
